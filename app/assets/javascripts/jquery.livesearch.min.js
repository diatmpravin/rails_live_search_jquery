/* jQuery Live Search Plugin 1.0.0
 * http://github.com/zykadelic/jquery-livesearch
 * 
 * Licensed under the GNU General Public License
 */
(function(a){var b=function(){return{init:function(b,c){var d=this;d.element=b,d.settings=c;d._runValidations();d.element.attr("autocomplete","off");if(!d.settings.resultsList.is("ul")){var e={};a.each(d.settings.resultsList[0].attributes,function(a,b){e[b.nodeName]=b.nodeValue});var f=a("<ul>",e);d.settings.resultsList.replaceWith(f);d.settings.resultsList=f}a(d.settings.resultsList.selector+" li").live("mouseenter.liveSearch",function(){a(d.settings.resultsList.selector+" li").removeClass("hover");a(this).addClass("hover")});a(d.settings.resultsList.selector+" li").live("mouseleave.liveSearch",function(){a(this).removeClass("hover")});d.element.live("focus.liveSearch",function(){if(d.settings.considerSpaces?a(this).val():a(this).val().trim())d.showResultsList()});d.element.live("keypress.liveSearch",function(a){d.keypress(String.fromCharCode(a.charCode))});d.element.live("keydown.liveSearch",function(a){d.keydown(a)});d.element.live("blur.liveSearch",function(){d.hideResultsList()});d.hideResultsList},keypress:function(a){var b=this.element.prop("previousValue")||"";var c=this.element.val()+a;this.element.prop("previousValue",c);if(a!=" "||this.settings.considerSpaces)this._search(c)},keydown:function(a){switch(a.keyCode){case 40:this._keynav("down");break;case 38:this._keynav("up");break;case 27:if(this.settings.blurOnEscape)this.element.blur();break;case 8:this._search(this.element.val().slice(0,-1));break;case 46:this._search(this.element.val().slice(0,-1));break}},hideResultsList:function(){this.settings.resultsList.css("display","none")},showResultsList:function(){this.settings.resultsList.css("display","block")},_search:function(b){var c=this;if(!c.settings.considerSpaces)b=b.trim().replace(/\s+/gi," ");if(b){c.showResultsList();c.settings.resultsList.addClass("loading")}else{c.hideResultsList()}var d={success:c.settings.request.success,error:c.settings.request.error};var e=a.extend(c.settings.request,{data:a.extend(c.settings.request.data,{query:b}),success:function(a,b,e){c.settings.resultsList.removeClass("loading");c._renderResults(a);d.success(a,b,e)},error:function(a,b,e){c.settings.resultsList.removeClass("loading");d.error(a,b,e)}});a.ajax(e)},_renderResults:function(b){var c=this,d="";if(b.length){a.each(b,function(b,e){var f;if(c.settings.template){f=a("<li>").html(a.tmpl(c.settings.template,e))}else{if(typeof e=="object")c.throwError("Response was of type Object, but no text/html-template was specified");f=a("<li>").html(e)}d+=a("<div>").html(f).html()})}else{if(c.settings.noResultsText)d=a("<li>").addClass("empty").html(c.settings.noResultsText)}c.settings.resultsList.html(d)},_keynav:function(a){var b=a=="up"?this.settings.resultsList.find("li").last():this.settings.resultsList.find("li").first();var c=this.settings.resultsList.find("li.hover");var d=a=="up"?c.prev("li"):c.next("li");if(c.length){c.removeClass("hover");d.length?d.addClass("hover"):b.addClass("hover")}else{b.addClass("hover")}},_runValidations:function(){if(!this.settings.request.url)this._throwError("Request URL is not specified");if(!this.settings.resultsList.length)this._throwError("Can't find resultsList element");if(this.settings.template){if(!this.settings.template.length)this._throwError("Can't find HTML-template");var b=this.settings.template[0].type;if(b)b=b.toLowerCase();if(b!="text/html-template")this._throwError('"'+this.settings.template.selector+'" is not a text/html-template');if(!a.tmpl)this._throwError("Use of HTML templates require the jQuery.tmpl plugin. Download at http://github.com/jquery/jquery-tmpl")}},_throwError:function(a){throw new Error("[jQuery liveSearch] "+a)}}};a.fn.liveSearch=function(c){var d=a.extend({type:"GET",dataType:"JSON",url:this.parents("form").attr("action"),data:{},success:function(a,b,c){},error:function(a,b,c){alert(b)}},c?c.request:undefined);var e=a.extend({considerSpaces:false,resultsList:a(".jquery-livesearch-results"),template:false,noResultsText:"No results found",blurOnEscape:true},c);e.request=d;return this.each(function(){(new b).init(a(this),e)})}})(jQuery)
